<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Changelog - Proyectos</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',sans-serif;background:#fafafa;color:#1a1a1a;line-height:1.6}
.header{background:#fff;border-bottom:1px solid #e5e7eb;padding:24px 0;position:sticky;top:0;z-index:100}
.hc{max-width:1000px;margin:0 auto;padding:0 24px}
.header h1{font-size:28px;font-weight:700}
.header p{color:#6b7280;font-size:15px}
.filters{background:#fff;border-bottom:1px solid #e5e7eb;padding:16px 0}
.fc{max-width:1000px;margin:0 auto;padding:0 24px;display:flex;gap:12px;flex-wrap:wrap}
.btn{padding:8px 16px;border:1px solid #e5e7eb;background:#fff;border-radius:20px;font-size:14px;cursor:pointer;color:#6b7280}
.btn:hover{border-color:#1a1a1a;color:#1a1a1a}
.btn.active{background:#1a1a1a;color:#fff}
.main{max-width:1000px;margin:0 auto;padding:32px 24px}
.box{background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:24px;margin-bottom:24px}
.stats{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px}
.stat{display:flex;align-items:center;gap:6px;padding:6px 12px;border-radius:8px;font-size:13px;cursor:pointer;border:2px solid transparent}
.stat.active{border-color:#1a1a1a}
.stat span:first-child{font-weight:700;font-size:16px}
.s-green{background:#dcfce7;color:#16a34a}
.s-blue{background:#dbeafe;color:#2563eb}
.s-red{background:#fee2e2;color:#dc2626}
.s-gray{background:#f3f4f6;color:#6b7280}
.s-purple{background:#ede9fe;color:#7c3aed}
.s-orange{background:#ffedd5;color:#ea580c;}
.summary{font-size:14px;background:#f3f4f6;padding:16px;border-radius:8px;white-space:pre-line}
.fbox{background:#f3f4f6;border-radius:8px;padding:16px;margin-bottom:24px}
.frow{display:flex;gap:24px;flex-wrap:wrap}
.fgrp{flex:1;min-width:200px}
.fgrp-title{font-size:11px;font-weight:600;color:#6b7280;margin-bottom:8px}
.tags{display:flex;gap:6px;flex-wrap:wrap;max-height:120px;overflow-y:auto}
.tag{padding:4px 10px;border-radius:14px;font-size:12px;cursor:pointer;background:#fff;border:1px solid #e5e7eb;color:#6b7280}
.tag:hover{border-color:#1a1a1a}
.tag.active{background:#2563eb;color:#fff;border-color:#2563eb}
.clr{font-size:12px;color:#dc2626;cursor:pointer;padding:4px 10px;background:#fee2e2;border-radius:14px;margin-top:20px}
.entry{display:grid;grid-template-columns:90px 1fr;gap:20px;padding:20px 0;border-bottom:1px solid #f3f4f6}
.edate{font-size:13px;color:#6b7280}
.econtent{display:flex;flex-direction:column;gap:6px}
.etitle{font-size:15px;font-weight:600;color:#1a1a1a;text-decoration:none}
.etitle:hover{color:#2563eb}
.edesc{font-size:13px;color:#6b7280}
.badges{display:flex;gap:6px;flex-wrap:wrap}
.badge{padding:3px 8px;border-radius:10px;font-size:11px;font-weight:500}
.b-proj{background:#f3f4f6;color:#6b7280}
.b-epic{background:#e0e7ff;color:#4338ca}
.emeta{display:flex;gap:12px;font-size:12px;color:#6b7280;flex-wrap:wrap}
.overdue{color:#dc2626;font-weight:600}
.ikey{font-size:11px;color:#2563eb;text-decoration:none}
.cmt{font-size:13px;padding:10px 14px;background:#f3f4f6;border-radius:8px;margin-top:6px;border-left:3px solid #2563eb}
.loading{text-align:center;padding:60px}
.spin{width:48px;height:48px;border:4px solid #e5e7eb;border-top-color:#2563eb;border-radius:50%;animation:spin .8s linear infinite;margin:0 auto 24px}
@keyframes spin{to{transform:rotate(360deg)}}
.prog{width:100%;max-width:400px;height:12px;background:#e5e7eb;border-radius:6px;margin:20px auto;overflow:hidden}
.prog-fill{height:100%;background:linear-gradient(90deg,#2563eb,#16a34a)}
.error{background:#fee2e2;color:#dc2626;padding:24px;border-radius:8px;text-align:center;margin:40px auto;max-width:600px}
.total{text-align:center;padding:16px;color:#6b7280;font-size:14px;background:#fff;border-radius:8px;margin-bottom:16px}
.pag{display:flex;justify-content:center;gap:16px;padding:24px}
.pag button{padding:10px 20px;border:1px solid #e5e7eb;background:#fff;border-radius:6px;cursor:pointer}
.pag button:disabled{opacity:.5;cursor:not-allowed}
@media(max-width:640px){.entry{grid-template-columns:1fr}.frow{flex-direction:column}}
</style>
</head>
<body>
<div id="app"></div>
<script>
const JIRA='https://educaedtech.atlassian.net';
const PROXY='https://jira-proxy.shopify-48b.workers.dev/?url=';
const PROJECTS=[
  {k:'SEI', n:'Euroinnova', links:{
    Confluence:'https://educaedtech.atlassian.net/wiki/spaces/SH',
    Backlog:'https://educaedtech.atlassian.net/jira/software/projects/SEI/boards/4/backlog'
  }},
  {k:'SEH', n:'EducaHub', links:{
    Confluence:'https://educaedtech.atlassian.net/wiki/spaces/EDUCAHUB',
    Backlog:'https://educaedtech.atlassian.net/jira/software/projects/SEH/boards/10/backlog'
  }},
  {k:'SUM', n:'Unimiami', links:{
    Confluence:'https://educaedtech.atlassian.net/wiki/spaces/SU',
    Backlog:'https://educaedtech.atlassian.net/jira/software/projects/SUM/boards/11/backlog'
  }},
  {k:'SST', n:'Structuralia', links:{
    Confluence:'https://educaedtech.atlassian.net/wiki/spaces/SHOPIFY',
    Backlog:'https://educaedtech.atlassian.net/jira/software/projects/SST/boards/8/backlog'
  }},
  {k:'STP', n:'Temarioenpdf', links:{
    Confluence:'https://educaedtech.atlassian.net/wiki/spaces/SHO',
    Backlog:'https://educaedtech.atlassian.net/jira/software/projects/STP/boards/9/backlog'
  }},
  {k:'SFC', n:'Formaci√≥n Continua', links:{
    Confluence:'https://educaedtech.atlassian.net/wiki/spaces/SFC',
    Backlog:'https://educaedtech.atlassian.net/jira/software/projects/SFC/boards/6/backlog'
  }},
  {k:'SCL', n:'Centro Lengua Capman', links:{
    Confluence:'https://educaedtech.atlassian.net/wiki/spaces/SCDLC',
    Backlog:'https://educaedtech.atlassian.net/jira/software/c/projects/SCL/boards/1416/backlog?epics=visible'
  }},
  {k:'SED', n:'Entorno Desarrollo', links:{
    Confluence:'https://educaedtech.atlassian.net/wiki/spaces/SED',
    Backlog:'https://educaedtech.atlassian.net/jira/software/projects/SED/boards/5/backlog'
  }},
  {k:'EHC', n:'EduHub Core', links:{
    Confluence:'https://educaedtech.atlassian.net/wiki/spaces/EC',
    Backlog:'https://educaedtech.atlassian.net/jira/software/projects/EHC/boards/12/backlog'
  }}
];
const BLOCKED=['PTE REQUISITOS'];
const IGNORE=['COMPLETADA','CANCELADA','STANDBY','PTE REQUISITOS'];
const AUTO=['this work item','created based on','jira form','email address:','automation','automatically','transitioned'];

let S={all:[],flt:[],load:false,prog:0,tot:0,err:null,proj:'ALL',stat:null,epic:null,user:null,epics:[],users:[],pg:0};

const fmt=d=>d?new Date(d).toLocaleDateString('es-ES',{day:'numeric',month:'short',year:'numeric'}):'';
const trunc=(t,m=140)=>{if(!t)return'';const c=String(t).replace(/<[^>]*>/g,'').replace(/\s+/g,' ').trim();return c.length<=m?c:c.slice(0,m)+'...'};
const adf=a=>{if(!a)return'';if(typeof a==='string')return a;let t='';const r=n=>{if(!n)return;if(n.text)t+=n.text+' ';if(n.content)n.content.forEach(r)};r(a);return t.trim()};
const isAuto=t=>!t||AUTO.some(f=>t.toLowerCase().includes(f));
const getCmt=c=>{if(!c||!c.length)return'';for(let i=c.length-1;i>=0;i--){const t=adf(c[i]?.body);if(t&&!isAuto(t)&&t.length>10)return trunc(t,200)}return''};

const sCat=s=>{
  const x=(s||'').toUpperCase();
  if(x==='COMPLETADA')return'completed';
  if(x==='CANCELADA')return'cancelled';
  if(x==='EN PROGRESO')return'progress';
  if(x.includes('QA')||x.includes('APROBADO'))return'qa';
  if(BLOCKED.includes(x))return'blocked';
  return'todo';
};

const sBadge=s=>{
  const x=(s||'').toUpperCase();
  if(x==='COMPLETADA')return's-green';
  if(x==='CANCELADA')return's-orange';
  if(x==='EN PROGRESO')return's-blue';
  if(x.includes('QA')||x.includes('APROBADO'))return's-purple';
  if(BLOCKED.includes(x))return's-red';
  return's-gray';
};
const dueS=(d,s)=>{if(!d)return{c:'',t:''};const due=new Date(d),now=new Date();now.setHours(0,0,0,0);const diff=Math.ceil((due-now)/864e5);if(diff<0&&!IGNORE.includes((s||'').toUpperCase()))return{c:'overdue',t:'‚ö†Ô∏è Vencida: '};if(diff>=0&&diff<=3)return{c:'',t:'‚è∞ '};return{c:'',t:'üìÖ '}};

const extFlt=()=>{const em=new Map(),um=new Map();S.all.forEach(i=>{const e=i.fields.parent?.fields?.summary;if(e)em.set(e,(em.get(e)||0)+1);const u=i.fields.assignee?.displayName;if(u)um.set(u,(um.get(u)||0)+1)});S.epics=[...em].sort((a,b)=>b[1]-a[1]).map(e=>({n:e[0],c:e[1]}));S.users=[...um].sort((a,b)=>b[1]-a[1]).map(u=>({n:u[0],c:u[1]}))};
const appFlt=()=>{let f=[...S.all];if(S.stat)f=f.filter(i=>sCat(i.fields.status?.name)===S.stat);if(S.epic)f=f.filter(i=>i.fields.parent?.fields?.summary===S.epic);if(S.user)f=f.filter(i=>i.fields.assignee?.displayName===S.user);S.flt=f;S.pg=0};
const clrFlt=()=>{S.stat=null;S.epic=null;S.user=null;S.flt=[...S.all];S.pg=0};

async function load(){
S.load=true;S.all=[];S.flt=[];S.prog=0;S.tot=0;S.err=null;clrFlt();render();
try{
const pf=S.proj==='ALL'?`project IN ("${PROJECTS.map(p=>p.k).join('","')}")`:`project="${S.proj}"`;
const jql=`${pf} ORDER BY updated DESC`;let npt=null,all=[];
do{
let url=`${JIRA}/rest/api/3/search/jql?jql=${encodeURIComponent(jql)}&maxResults=100&fields=summary,description,status,created,updated,resolutiondate,assignee,comment,duedate,parent,issuetype`;
if(npt)url+=`&nextPageToken=${encodeURIComponent(npt)}`;
const res=await fetch(PROXY+encodeURIComponent(url),{headers:{'Accept':'application/json'}});
if(!res.ok)throw new Error(`Error ${res.status}`);
const data=await res.json();all=[...all,...(data.issues||[])];
if(!S.tot&&data.total)S.tot=data.total;S.prog=all.length;render();
npt=data.nextPageToken;if(npt)await new Promise(r=>setTimeout(r,50));
}while(npt);
S.all=all.filter(i=>(i.fields.issuetype?.name||'').toLowerCase()!=='epic');S.flt=[...S.all];extFlt();
}catch(e){S.err=e.message}
S.load=false;render();
}

function render(){document.getElementById('app').innerHTML=html();bindE()}

function html(){
const st=cStats(),hasF=S.stat||S.epic||S.user;
const si=S.pg*50,ei=si+50,di=S.flt.slice(si,ei),tp=Math.ceil(S.flt.length/50);
return`
<header class="header"><div class="hc"><h1>üîÑ Changelog</h1><p>Proyectos - EducaEdtech</p></div></header>
<nav class="filters"><div class="fc">
<button class="btn ${S.proj==='ALL'?'active':''}" data-p="ALL">Todos</button>
${PROJECTS.map(p=>`<button class="btn ${S.proj===p.k?'active':''}" data-p="${p.k}">${p.n}</button>`).join('')}
</div></nav>
<main class="main">
${S.err?`<div class="error">‚ö†Ô∏è ${S.err}<br><small>Verifica credenciales en Worker Cloudflare</small></div>`:''}
${S.load?`<div class="loading"><div class="spin"></div><p style="font-size:20px;font-weight:600">Cargando...</p><p style="font-size:32px;font-weight:700;color:#2563eb">${S.prog}${S.tot?' / '+S.tot:''}</p>${S.tot?`<div class="prog"><div class="prog-fill" style="width:${Math.round(S.prog/S.tot*100)}%"></div></div>`:''}</div>`:''}
${!S.load&&!S.err&&S.all.length?`
<div class="box"><div class="stats">
<div class="stat s-green ${S.stat==='completed'?'active':''}" data-s="completed"><span>${st.completed}</span><span>Completadas</span></div>
<div class="stat s-blue ${S.stat==='progress'?'active':''}" data-s="progress"><span>${st.progress}</span><span>En Progreso</span></div>
<div class="stat s-purple ${S.stat==='qa'?'active':''}" data-s="qa"><span>${st.qa}</span><span>En QA</span></div>
<div class="stat s-red ${S.stat==='blocked'?'active':''}" data-s="blocked"><span>${st.blocked}</span><span>Bloqueadas</span></div>
<div class="stat s-gray ${S.stat==='todo'?'active':''}" data-s="todo"><span>${st.todo}</span><span>Pendientes</span></div>
<div class="stat s-orange ${S.stat==='cancelled'?'active':''}" data-s="cancelled"><span>${st.cancelled}</span><span>Canceladas</span></div>
${genProjectLinks()}
${genHealthSummary(st)}
${genSummaryTable(st)}
<div class="summary">${genSum(st)}</div>
${genStoppers()}</div>
<div class="fbox"><div class="frow">
<div class="fgrp"><div class="fgrp-title">√âpicas (${S.epics.length})</div><div class="tags">${S.epics.map(e=>`<span class="tag ${S.epic===e.n?'active':''}" data-e="${e.n}">${trunc(e.n,20)} (${e.c})</span>`).join('')||'Sin √©picas'}</div></div>
<div class="fgrp"><div class="fgrp-title">Usuarios (${S.users.length})</div><div class="tags">${S.users.map(u=>`<span class="tag ${S.user===u.n?'active':''}" data-u="${u.n}">${u.n.split(' ')[0]} (${u.c})</span>`).join('')||'Sin usuarios'}</div></div>
${hasF?'<span class="clr" id="clr">‚úï Limpiar</span>':''}
</div></div>
<div class="total">üìä <strong>${S.all.length}</strong> tareas${hasF?` ‚Üí <strong>${S.flt.length}</strong> filtradas`:''}</div>
${di.map(rEntry).join('')}
${tp>1?`<div class="pag"><button id="prev" ${S.pg===0?'disabled':''}>‚Üê Anterior</button><span>P√°g ${S.pg+1}/${tp}</span><button id="next" ${S.pg>=tp-1?'disabled':''}>Siguiente ‚Üí</button></div>`:''}
`:''}
</main>`;
}

function cStats(){
  const s={completed:0,progress:0,blocked:0,todo:0,qa:0,cancelled:0};
  S.flt.forEach(i=>s[sCat(i.fields.status?.name)]++);
  return s;
}

function genSummaryTable(s){
  const t = S.flt.length || 1;

  const row = (icon, label, val) =>
    `<tr>
      <td>${icon} ${label}</td>
      <td><strong>${val}</strong></td>
      <td>${Math.round(val/t*100)}%</td>
    </tr>`;

  return `
  <table style="width:100%;font-size:13px;border-collapse:collapse;margin:12px 0 20px">
    <thead>
      <tr style="text-align:left;color:#6b7280;border-bottom:1px solid #e5e7eb">
        <th>Estado</th>
        <th>Cantidad</th>
        <th>%</th>
      </tr>
    </thead>
    <tbody>
      ${row('‚úÖ','Completadas', s.completed)}
      ${row('üîÑ','En progreso', s.progress)}
      ${row('üß™','En QA', s.qa)}
      ${row('üö´','Stopper', s.blocked)}
      ${row('üìã','Pendientes', s.todo)}
      ${row('üü†','Canceladas', s.cancelled)}
    </tbody>
  </table>`;
}



function genProjectLinks(){
if(S.proj==='ALL')return'';
const proj=PROJECTS.find(p=>p.k===S.proj);
if(!proj||!proj.links)return'';

const L=proj.links;
let h=`<div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px">`;

if(L.Confluence)h+=`<a href="${L.Confluence}" target="_blank" style="display:inline-flex;align-items:center;gap:6px;padding:8px 14px;background:#fff;border:1px solid #e5e7eb;border-radius:6px;font-size:13px;color:#1a1a1a;text-decoration:none;font-weight:500"><span style="font-size:16px">üìö</span>Confluence</a>`;

if(L.Figma)h+=`<a href="${L.Figma}" target="_blank" style="display:inline-flex;align-items:center;gap:6px;padding:8px 14px;background:#fff;border:1px solid #e5e7eb;border-radius:6px;font-size:13px;color:#1a1a1a;text-decoration:none;font-weight:500"><span style="font-size:16px">üé®</span>Figma</a>`;

if(L.Backlog)h+=`<a href="${L.Backlog}" target="_blank" style="display:inline-flex;align-items:center;gap:6px;padding:8px 14px;background:#fff;border:1px solid #e5e7eb;border-radius:6px;font-size:13px;color:#1a1a1a;text-decoration:none;font-weight:500"><span style="font-size:16px">üìã</span>Backlog</a>`;

h+=`</div>`;
return h;
}

function genHealthSummary(s){
  const t = S.flt.length;
  if(!t) return '';

  const pct = Math.round(s.completed / t * 100);
  let status = 'üü¢ Salud √≥ptima';
  let color = '#16a34a';

  if (s.blocked > 0 || pct < 40) {
    status = 'üî¥ Riesgo alto';
    color = '#dc2626';
  } else if (pct < 70) {
    status = 'üü° Progreso estable';
    color = '#ea580c';
  }

  const projName =
    S.proj === 'ALL'
      ? 'Todos los proyectos'
      : PROJECTS.find(p => p.k === S.proj)?.n || S.proj;

  let txt = `
<strong>${status} ‚Äì ${projName}</strong><br>
${pct}% de las tareas est√°n completadas (${s.completed} de ${t}).`;

  if (s.blocked)
    txt += `<br>üö´ <strong>${s.blocked} stoppers activos</strong> requieren atenci√≥n inmediata.`;

  if (s.progress)
    txt += `<br>üîÑ ${s.progress} tareas en progreso.`;

  if (s.todo)
    txt += `<br>üìã ${s.todo} tareas pendientes de iniciar.`;

  return `
  <div style="
    background:#fff;
    border-left:4px solid ${color};
    padding:16px;
    border-radius:8px;
    margin-bottom:16px;
    font-size:14px;
    line-height:1.5
  ">
    ${txt}
  </div>`;
}


function genSum(s){
  const t = S.flt.length;
  if(!t) return '';

  const pn =
    S.proj === 'ALL'
      ? 'TODOS LOS PROYECTOS'
      : PROJECTS.find(p => p.k === S.proj)?.n?.toUpperCase() || S.proj;

  const now = new Date();
  now.setHours(0,0,0,0);

  const weekAgo = new Date();
  weekAgo.setDate(weekAgo.getDate() - 7);

  const overdue = S.flt.filter(i=>{
    if(!i.fields.duedate) return false;
    const d = new Date(i.fields.duedate);
    return d < now && !IGNORE.includes((i.fields.status?.name||'').toUpperCase());
  }).length;

  const recentDone = S.flt.filter(i=>{
    if((i.fields.status?.name||'').toUpperCase() !== 'COMPLETADA' || !i.fields.resolutiondate) return false;
    return new Date(i.fields.resolutiondate) >= weekAgo;
  }).length;

  let r = `üìä RESUMEN DE ${pn}\n\n`;
  r += `Historial completo: ${t} tareas. `;

  const pc = Math.round(s.completed / t * 100);
  r += `Completadas: ${s.completed} (${pc}%). `;

  if(s.cancelled){
    const pcan = Math.round(s.cancelled / t * 100);
    r += `Canceladas: ${s.cancelled} (${pcan}%). `;
  }

  if(recentDone) r += `Esta semana se completaron ${recentDone}. `;
  if(overdue) r += `‚ö†Ô∏è ${overdue} con fecha vencida. `;

  if(s.progress || s.qa){
    r += `\n\nüìå Estado actual:\n`;
    if(s.blocked) r += `‚Ä¢ üö´ ${s.blocked} stopper activos\n`;
    if(s.progress) r += `‚Ä¢ üîÑ ${s.progress} en progreso\n`;
    if(s.todo) r += `‚Ä¢ üìã ${s.todo} pendientes\n`;
  }

  return r;
}


function genStoppers(){
const blockers=S.flt.filter(i=>BLOCKED.includes((i.fields.status?.name||'').toUpperCase()));
if(!blockers.length)return'';

let h=`<div style="margin-top:16px;padding:16px;background:#fee2e2;border-radius:8px;border:1px solid #fecaca">`;
h+=`<div style="font-weight:600;color:#dc2626;margin-bottom:12px">üö® STOPPERS (${blockers.length}) - Requieren atenci√≥n inmediata</div>`;

blockers.forEach(b=>{
const st=b.fields.status?.name||'';
const assignee=b.fields.assignee?.displayName||'Sin asignar';
h+=`<div style="padding:8px 0;border-bottom:1px solid #fecaca;font-size:13px">`;
h+=`<a href="${JIRA}/browse/${b.key}" target="_blank" style="color:#dc2626;font-weight:600;text-decoration:none">${b.key}</a> `;
h+=`<span style="color:#1a1a1a">${trunc(b.fields.summary,60)}</span><br>`;
h+=`<span style="font-size:12px;color:#6b7280">${st} ‚Ä¢ ${assignee}</span>`;
h+=`</div>`;
});

h+=`</div>`;
return h;
}

function rEntry(i){
const st=i.fields.status?.name||'',pr=PROJECTS.find(p=>p.k===i.key.split('-')[0]),ds=dueS(i.fields.duedate,st);
const ep=i.fields.parent?.fields?.summary,desc=i.fields.description?trunc(adf(i.fields.description),120):'';
const cm=getCmt(i.fields.comment?.comments);
return`<div class="entry"><div class="edate">${fmt(i.fields.updated)}</div><div class="econtent">
<a href="${JIRA}/browse/${i.key}" target="_blank" class="etitle">${i.fields.summary}</a>
${desc?`<p class="edesc">${desc}</p>`:''}
<div class="badges"><span class="badge ${sBadge(st)}">${st}</span>${pr?`<span class="badge b-proj">${pr.n}</span>`:''}${ep?`<span class="badge b-epic">${trunc(ep,18)}</span>`:''}<a href="${JIRA}/browse/${i.key}" target="_blank" class="ikey">${i.key}</a></div>
<div class="emeta">${i.fields.duedate?`<span class="${ds.c}">${ds.t}${fmt(i.fields.duedate)}</span>`:''}<span>üìÖ Creado: ${fmt(i.fields.created)}</span><span>üë§ ${i.fields.assignee?.displayName||'Sin asignar'}</span></div>
${cm?`<div class="cmt">üí¨ ${cm}</div>`:''}
</div></div>`;
}

function bindE(){
document.querySelectorAll('[data-p]').forEach(b=>b.onclick=()=>{S.proj=b.dataset.p;load()});
document.querySelectorAll('[data-s]').forEach(b=>b.onclick=()=>{S.stat=S.stat===b.dataset.s?null:b.dataset.s;appFlt();render()});
document.querySelectorAll('[data-e]').forEach(b=>b.onclick=()=>{S.epic=S.epic===b.dataset.e?null:b.dataset.e;appFlt();render()});
document.querySelectorAll('[data-u]').forEach(b=>b.onclick=()=>{S.user=S.user===b.dataset.u?null:b.dataset.u;appFlt();render()});
document.getElementById('clr')?.addEventListener('click',()=>{clrFlt();render()});
document.getElementById('prev')?.addEventListener('click',()=>{if(S.pg>0){S.pg--;render();scrollTo(0,0)}});
document.getElementById('next')?.addEventListener('click',()=>{if(S.pg<Math.ceil(S.flt.length/50)-1){S.pg++;render();scrollTo(0,0)}});
}

render();load();
</script>
</body>
</html>
