<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Changelog - Proyectos Shopify</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --color-bg: #fafafa;
            --color-surface: #ffffff;
            --color-text: #1a1a1a;
            --color-text-secondary: #6b7280;
            --color-border: #e5e7eb;
            --color-border-light: #f3f4f6;
            --status-completed: #16a34a;
            --status-completed-bg: #dcfce7;
            --status-in-progress: #2563eb;
            --status-in-progress-bg: #dbeafe;
            --status-todo: #6b7280;
            --status-todo-bg: #f3f4f6;
            --status-blocked: #dc2626;
            --status-blocked-bg: #fee2e2;
            --status-qa: #7c3aed;
            --status-qa-bg: #ede9fe;
            --status-cancelled: #78716c;
            --status-cancelled-bg: #f5f5f4;
            --status-approval: #f59e0b;
            --status-approval-bg: #fef3c7;
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
            --radius: 8px;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: var(--font-sans);
            background: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
        }
        
        .header {
            background: var(--color-surface);
            border-bottom: 1px solid var(--color-border);
            padding: 24px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 24px;
        }
        
        .header h1 { font-size: 28px; font-weight: 700; margin-bottom: 4px; }
        .header p { color: var(--color-text-secondary); font-size: 15px; }
        
        .filters {
            background: var(--color-surface);
            border-bottom: 1px solid var(--color-border);
            padding: 16px 0;
        }
        
        .filters-content {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 24px;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-btn {
            padding: 8px 16px;
            border: 1px solid var(--color-border);
            background: var(--color-surface);
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: var(--font-sans);
        }
        
        .filter-btn:hover { border-color: var(--color-text); color: var(--color-text); }
        .filter-btn.active { background: var(--color-text); color: white; border-color: var(--color-text); }
        .filter-label { font-size: 13px; color: var(--color-text-secondary); font-weight: 500; }
        
        .main {
            max-width: 900px;
            margin: 0 auto;
            padding: 32px 24px;
        }
        
        .config-panel {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius);
            padding: 24px;
            max-width: 450px;
            margin: 40px auto;
        }
        
        .config-panel h2 { font-size: 18px; margin-bottom: 20px; }
        .config-panel label { display: block; font-size: 14px; font-weight: 500; margin-bottom: 6px; }
        
        .config-panel input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            font-size: 14px;
            font-family: var(--font-mono);
            margin-bottom: 16px;
        }
        
        .config-panel input:focus { outline: none; border-color: var(--status-in-progress); }
        
        .config-panel button {
            width: 100%;
            padding: 12px;
            background: var(--color-text);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .config-panel button:hover { opacity: 0.9; }
        .config-panel .hint { font-size: 12px; color: var(--color-text-secondary); margin-top: -12px; margin-bottom: 16px; }
        .config-panel .hint a { color: var(--status-in-progress); }
        
        .summary-section {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 32px;
        }
        
        .summary-stats { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 20px; }
        
        .stat-card {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .stat-card .stat-count { font-weight: 700; font-size: 18px; }
        .stat-completed { background: var(--status-completed-bg); color: var(--status-completed); }
        .stat-in-progress { background: var(--status-in-progress-bg); color: var(--status-in-progress); }
        .stat-blocked { background: var(--status-blocked-bg); color: var(--status-blocked); }
        .stat-todo { background: var(--status-todo-bg); color: var(--status-todo); }
        .stat-qa { background: var(--status-qa-bg); color: var(--status-qa); }
        .stat-cancelled { background: var(--status-cancelled-bg); color: var(--status-cancelled); }
        
        .summary-text { font-size: 15px; line-height: 1.7; margin-bottom: 20px; }
        
        .blockers-section {
            background: var(--status-blocked-bg);
            border: 1px solid #fecaca;
            border-radius: var(--radius);
            padding: 16px;
        }
        
        .blockers-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--status-blocked);
            margin-bottom: 12px;
        }
        
        .blocker-item {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 10px 0;
            border-bottom: 1px solid #fecaca;
            gap: 12px;
        }
        
        .blocker-item:last-child { border-bottom: none; padding-bottom: 0; }
        .blocker-info { flex: 1; }
        .blocker-title { font-size: 14px; font-weight: 500; color: var(--color-text); text-decoration: none; }
        .blocker-title:hover { color: var(--status-in-progress); }
        .blocker-meta { font-size: 12px; color: var(--color-text-secondary); margin-top: 4px; }
        .blocker-deadline { font-size: 12px; font-weight: 600; color: var(--status-blocked); }
        
        .changelog-entry {
            display: grid;
            grid-template-columns: 100px 1fr;
            gap: 24px;
            padding: 24px 0;
            border-bottom: 1px solid var(--color-border-light);
        }
        
        .entry-date { font-size: 14px; color: var(--color-text-secondary); font-weight: 500; }
        .entry-content { display: flex; flex-direction: column; gap: 8px; }
        .entry-title { font-size: 16px; font-weight: 600; color: var(--color-text); text-decoration: none; }
        .entry-title:hover { color: var(--status-in-progress); }
        .entry-badges { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 2px; }
        
        .badge {
            display: inline-flex;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .badge-project { background: var(--color-border-light); color: var(--color-text-secondary); }
        .status-completada { background: var(--status-completed-bg); color: var(--status-completed); }
        .status-en-progreso { background: var(--status-in-progress-bg); color: var(--status-in-progress); }
        .status-por-hacer, .status-estimacion, .status-standby { background: var(--status-todo-bg); color: var(--status-todo); }
        .status-pte-requisitos, .status-rechazada { background: var(--status-blocked-bg); color: var(--status-blocked); }
        .status-qa { background: var(--status-qa-bg); color: var(--status-qa); }
        .status-cancelada { background: var(--status-cancelled-bg); color: var(--status-cancelled); }
        .status-pte-aprobacion { background: var(--status-approval-bg); color: var(--status-approval); }
        
        .entry-meta { display: flex; gap: 16px; font-size: 13px; color: var(--color-text-secondary); flex-wrap: wrap; }
        .deadline-overdue { color: var(--status-blocked); font-weight: 600; }
        .deadline-soon { color: var(--status-approval); }
        
        .issue-key { font-family: var(--font-mono); font-size: 12px; color: var(--status-in-progress); text-decoration: none; font-weight: 500; }
        .issue-key:hover { text-decoration: underline; }
        
        .entry-comments {
            font-size: 14px;
            color: var(--color-text-secondary);
            font-style: italic;
            padding: 12px 16px;
            background: var(--color-border-light);
            border-radius: var(--radius);
            margin-top: 8px;
            border-left: 3px solid var(--color-border);
        }
        
        .loading { text-align: center; padding: 60px; color: var(--color-text-secondary); }
        .loading-spinner {
            width: 32px; height: 32px;
            border: 3px solid var(--color-border);
            border-top-color: var(--color-text);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 16px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .error {
            background: var(--status-blocked-bg);
            color: var(--status-blocked);
            padding: 16px 24px;
            border-radius: var(--radius);
            text-align: center;
            margin-bottom: 24px;
        }
        
        .error button {
            margin-top: 12px;
            background: transparent;
            border: 1px solid currentColor;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            color: inherit;
            font-size: 14px;
        }
        
        .pagination { display: flex; justify-content: center; gap: 8px; padding: 32px 0; }
        .pagination button {
            padding: 10px 20px;
            border: 1px solid var(--color-border);
            background: var(--color-surface);
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }
        .pagination button:hover:not(:disabled) { border-color: var(--color-text); }
        .pagination button:disabled { opacity: 0.5; cursor: not-allowed; }
        .pagination span { padding: 10px 16px; color: var(--color-text-secondary); }
        
        .empty-state { text-align: center; padding: 60px; color: var(--color-text-secondary); }
        
        @media (max-width: 640px) {
            .changelog-entry { grid-template-columns: 1fr; gap: 8px; }
            .filters-content { gap: 8px; }
            .filter-btn { padding: 6px 12px; font-size: 13px; }
        }
    </style>
</head>
<body>
    <div id="app">
        <header class="header">
            <div class="header-content">
                <h1>üîÑ Changelog</h1>
                <p>Proyectos Shopify - EducaEdtech</p>
            </div>
        </header>
        <main class="main">
            <div class="config-panel">
                <h2>‚öôÔ∏è Configuraci√≥n de Jira</h2>
                <form id="configForm">
                    <label>Email de Atlassian</label>
                    <input type="email" id="emailInput" placeholder="tu@email.com" required>
                    
                    <label>API Token</label>
                    <input type="password" id="tokenInput" placeholder="Tu API token de Jira" required>
                    <p class="hint">Cr√©alo en: <a href="https://id.atlassian.com/manage-profile/security/api-tokens" target="_blank">id.atlassian.com</a></p>
                    
                    <button type="submit">Conectar con Jira</button>
                </form>
            </div>
        </main>
    </div>

    <script>
        // ==========================================
        // CONFIGURACI√ìN - EDITAR AQU√ç LOS PROYECTOS
        // ==========================================
        const PROJECTS = [
            { key: 'SEI', name: 'Euroinnova' },
            { key: 'SEH', name: 'EducaHub' },
            { key: 'SUM', name: 'Unimiami' },
            { key: 'SST', name: 'Structuralia' },
            { key: 'STP', name: 'Temarioenpdf' },
            { key: 'SFC', name: 'Formaci√≥n Continua' },
            { key: 'SCL', name: 'Centro de Lengua Capman' },
            { key: 'SED', name: 'Entorno Desarrollo' },
            { key: 'EHC', name: 'EduHub Core' }
        ];
        
        const JIRA_BASE_URL = 'https://educaedtech.atlassian.net';
        const CORS_PROXY = 'https://jira-proxy.shopify-48b.workers.dev/?url=';
        const BLOCKER_STATUSES = ['PTE REQUISITOS', 'STANDBY', 'RECHAZADA - POR HACER'];
        
        // ==========================================
        // ESTADO DE LA APLICACI√ìN
        // ==========================================
        let state = {
            email: null,
            token: null,
            issues: [],
            loading: false,
            error: null,
            selectedProject: 'ALL',
            page: 0,
            total: 0,
            pageSize: 25
        };
        
        // ==========================================
        // UTILIDADES
        // ==========================================
        function safeStorage(action, key, value) {
            try {
                if (action === 'get') return localStorage.getItem(key);
                if (action === 'set') localStorage.setItem(key, value);
                if (action === 'remove') localStorage.removeItem(key);
            } catch (e) { return null; }
        }
        
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('es-ES', { month: 'short', day: 'numeric' });
        }
        
        function truncate(text, maxLength = 140) {
            if (!text) return '';
            const clean = text.replace(/<[^>]*>/g, '').replace(/\{[^}]*\}/g, '').trim();
            return clean.length <= maxLength ? clean : clean.substring(0, maxLength).trim() + '...';
        }
        
        function getStatusClass(status) {
            const map = {
                'COMPLETADA': 'completada', 'CANCELADA': 'cancelada', 'EN PROGRESO': 'en-progreso',
                'POR HACER': 'por-hacer', 'ESTIMACI√ìN': 'estimacion', 'ESTIMACION': 'estimacion',
                'PTE DE APROBACI√ìN': 'pte-aprobacion', 'PTE APROBACI√ìN PR': 'pte-aprobacion',
                'PTE REQUISITOS': 'pte-requisitos', 'STANDBY': 'standby', 'RECHAZADA - POR HACER': 'rechazada',
                'QA - ENTORNO DEV': 'qa', 'QA - ENTORNO PROD': 'qa', 'APROBADO QA DEV': 'qa'
            };
            return map[status?.toUpperCase()] || 'por-hacer';
        }
        
        function getDueDateStatus(duedate) {
            if (!duedate) return { class: '', text: '' };
            const due = new Date(duedate);
            const today = new Date();
            const diffDays = Math.ceil((due - today) / (1000 * 60 * 60 * 24));
            if (diffDays < 0) return { class: 'deadline-overdue', text: '‚ö†Ô∏è Vencida: ' };
            if (diffDays <= 3) return { class: 'deadline-soon', text: '‚è∞ ' };
            return { class: '', text: 'üìÖ ' };
        }
        
        // ==========================================
        // API DE JIRA
        // ==========================================
        async function fetchIssues() {
            if (!state.email || !state.token) return;
            
            state.loading = true;
            state.error = null;
            render();
            
            try {
                const projectFilter = state.selectedProject === 'ALL'
                    ? `project IN (${PROJECTS.map(p => p.key).join(', ')})`
                    : `project = ${state.selectedProject}`;
                
                const jql = `${projectFilter} ORDER BY created DESC`;
                const apiUrl = `${JIRA_BASE_URL}/rest/api/3/search/jql?jql=${encodeURIComponent(jql)}&startAt=${state.page * state.pageSize}&maxResults=${state.pageSize}&fields=summary,status,created,updated,resolutiondate,assignee,comment,duedate`;
                const fetchUrl = CORS_PROXY + encodeURIComponent(apiUrl);
                
                const response = await fetch(fetchUrl, {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Basic ' + btoa(state.email + ':' + state.token),
                        'Accept': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    if (response.status === 401) {
                        throw new Error('Credenciales inv√°lidas. Verifica tu email y API token.');
                    } else if (response.status === 403) {
                        throw new Error('Sin permisos. Verifica que tu usuario tenga acceso a los proyectos.');
                    }
                    throw new Error('Error ' + response.status + ': ' + response.statusText);
                }
                
                const data = await response.json();
                state.issues = data.issues || [];
                state.total = data.total || 0;
            } catch (err) {
                state.error = err.message;
            } finally {
                state.loading = false;
                render();
            }
        }
        
        // ==========================================
        // RENDERIZADO
        // ==========================================
        function render() {
            const app = document.getElementById('app');
            
            if (!state.email || !state.token) {
                app.innerHTML = renderConfigPanel();
                attachConfigEvents();
                return;
            }
            
            app.innerHTML = renderMainApp();
            attachMainEvents();
        }
        
        function renderConfigPanel() {
            return `
                <header class="header">
                    <div class="header-content">
                        <h1>üîÑ Changelog</h1>
                        <p>Proyectos Shopify - EducaEdtech</p>
                    </div>
                </header>
                <main class="main">
                    <div class="config-panel">
                        <h2>‚öôÔ∏è Configuraci√≥n de Jira</h2>
                        <form id="configForm">
                            <label>Email de Atlassian</label>
                            <input type="email" id="emailInput" placeholder="tu@email.com" required>
                            
                            <label>API Token</label>
                            <input type="password" id="tokenInput" placeholder="Tu API token de Jira" required>
                            <p class="hint">Cr√©alo en: <a href="https://id.atlassian.com/manage-profile/security/api-tokens" target="_blank">id.atlassian.com</a></p>
                            
                            <button type="submit">Conectar con Jira</button>
                        </form>
                    </div>
                </main>
            `;
        }
        
        function renderMainApp() {
            const stats = calculateStats();
            const blockers = state.issues.filter(i => BLOCKER_STATUSES.includes(i.fields.status?.name?.toUpperCase()));
            const totalPages = Math.ceil(state.total / state.pageSize);
            
            return `
                <header class="header">
                    <div class="header-content">
                        <h1>üîÑ Changelog</h1>
                        <p>Novedades y actualizaciones de los proyectos Shopify</p>
                    </div>
                </header>
                
                <nav class="filters">
                    <div class="filters-content">
                        <span class="filter-label">Filtrar:</span>
                        <button class="filter-btn ${state.selectedProject === 'ALL' ? 'active' : ''}" data-project="ALL">Todos</button>
                        ${PROJECTS.map(p => `
                            <button class="filter-btn ${state.selectedProject === p.key ? 'active' : ''}" data-project="${p.key}">${p.name}</button>
                        `).join('')}
                    </div>
                </nav>
                
                <main class="main">
                    ${state.error ? `
                        <div class="error">
                            ‚ö†Ô∏è ${state.error}
                            <br>
                            <button id="resetBtn">Reconfigurar credenciales</button>
                        </div>
                    ` : ''}
                    
                    ${state.loading ? `
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <p>Cargando tareas desde Jira...</p>
                        </div>
                    ` : ''}
                    
                    ${!state.loading && !state.error && state.issues.length > 0 ? `
                        ${renderSummary(stats, blockers)}
                        ${state.issues.map(issue => renderEntry(issue)).join('')}
                        ${totalPages > 1 ? renderPagination(totalPages) : ''}
                    ` : ''}
                    
                    ${!state.loading && !state.error && state.issues.length === 0 ? `
                        <div class="empty-state">
                            <p>No hay tareas para mostrar</p>
                        </div>
                    ` : ''}
                </main>
            `;
        }
        
        function calculateStats() {
            const stats = { completed: 0, inProgress: 0, blocked: 0, todo: 0, qa: 0, cancelled: 0 };
            state.issues.forEach(issue => {
                const status = issue.fields.status?.name?.toUpperCase() || '';
                if (status === 'COMPLETADA') stats.completed++;
                else if (status === 'EN PROGRESO') stats.inProgress++;
                else if (BLOCKER_STATUSES.includes(status)) stats.blocked++;
                else if (status.includes('QA') || status.includes('APROBADO')) stats.qa++;
                else if (status === 'CANCELADA') stats.cancelled++;
                else stats.todo++;
            });
            return stats;
        }
        
        function renderSummary(stats, blockers) {
            const total = state.issues.length;
            const overdue = state.issues.filter(i => i.fields.duedate && new Date(i.fields.duedate) < new Date() && i.fields.status?.name?.toUpperCase() !== 'COMPLETADA').length;
            
            let summaryText = `üìä Este changelog muestra ${total} tareas.`;
            if (stats.completed > 0) summaryText += ` ‚úÖ ${stats.completed} completadas (${Math.round(stats.completed/total*100)}%).`;
            if (stats.inProgress > 0) summaryText += ` üîÑ ${stats.inProgress} en progreso.`;
            if (stats.qa > 0) summaryText += ` üß™ ${stats.qa} en QA.`;
            if (stats.blocked > 0) summaryText += ` ‚ö†Ô∏è ${stats.blocked} bloqueadas.`;
            if (overdue > 0) summaryText += ` üö® ${overdue} vencidas.`;
            
            return `
                <div class="summary-section">
                    <div class="summary-stats">
                        <div class="stat-card stat-completed"><span class="stat-count">${stats.completed}</span><span>Completadas</span></div>
                        <div class="stat-card stat-in-progress"><span class="stat-count">${stats.inProgress}</span><span>En Progreso</span></div>
                        <div class="stat-card stat-qa"><span class="stat-count">${stats.qa}</span><span>En QA</span></div>
                        <div class="stat-card stat-blocked"><span class="stat-count">${stats.blocked}</span><span>Bloqueadas</span></div>
                        <div class="stat-card stat-todo"><span class="stat-count">${stats.todo}</span><span>Pendientes</span></div>
                        ${stats.cancelled > 0 ? `<div class="stat-card stat-cancelled"><span class="stat-count">${stats.cancelled}</span><span>Canceladas</span></div>` : ''}
                    </div>
                    <p class="summary-text">${summaryText}</p>
                    ${blockers.length > 0 ? `
                        <div class="blockers-section">
                            <div class="blockers-title">üö´ STOPPERS - Requieren atenci√≥n inmediata</div>
                            ${blockers.slice(0, 5).map(issue => {
                                const project = PROJECTS.find(p => p.key === issue.key.split('-')[0]);
                                const dueStatus = getDueDateStatus(issue.fields.duedate);
                                return `
                                    <div class="blocker-item">
                                        <div class="blocker-info">
                                            <a href="${JIRA_BASE_URL}/browse/${issue.key}" target="_blank" class="blocker-title">${issue.fields.summary}</a>
                                            <div class="blocker-meta">${issue.key} ‚Ä¢ ${project?.name || ''} ‚Ä¢ ${issue.fields.status?.name}${issue.fields.assignee ? ' ‚Ä¢ ' + issue.fields.assignee.displayName : ''}</div>
                                        </div>
                                        ${issue.fields.duedate ? `<span class="blocker-deadline ${dueStatus.class}">${dueStatus.text}${formatDate(issue.fields.duedate)}</span>` : ''}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
        }
        
        function renderEntry(issue) {
            const status = issue.fields.status?.name || 'Sin estado';
            const project = PROJECTS.find(p => p.key === issue.key.split('-')[0]);
            const dueStatus = getDueDateStatus(issue.fields.duedate);
            const comments = issue.fields.comment?.comments || [];
            const commentsSummary = comments.length > 0 ? truncate(comments.map(c => c.body).join(' | '), 140) : null;
            
            return `
                <div class="changelog-entry">
                    <div class="entry-date">${formatDate(issue.fields.created)}</div>
                    <div class="entry-content">
                        <a href="${JIRA_BASE_URL}/browse/${issue.key}" target="_blank" class="entry-title">${issue.fields.summary}</a>
                        <div class="entry-badges">
                            <span class="badge status-${getStatusClass(status)}">${status}</span>
                            ${project ? `<span class="badge badge-project">${project.name}</span>` : ''}
                            <a href="${JIRA_BASE_URL}/browse/${issue.key}" target="_blank" class="issue-key">${issue.key}</a>
                        </div>
                        <div class="entry-meta">
                            ${issue.fields.resolutiondate ? `<span>‚úÖ Completada: ${formatDate(issue.fields.resolutiondate)}</span>` : ''}
                            ${issue.fields.duedate ? `<span class="${dueStatus.class}">${dueStatus.text}Entrega: ${formatDate(issue.fields.duedate)}</span>` : ''}
                            <span>üïê Actualizada: ${formatDate(issue.fields.updated)}</span>
                            <span>üë§ ${issue.fields.assignee?.displayName || 'Sin asignar'}</span>
                        </div>
                        ${commentsSummary ? `<div class="entry-comments">üí¨ ${commentsSummary}</div>` : ''}
                    </div>
                </div>
            `;
        }
        
        function renderPagination(totalPages) {
            return `
                <div class="pagination">
                    <button id="prevBtn" ${state.page === 0 ? 'disabled' : ''}>‚Üê Anterior</button>
                    <span>P√°gina ${state.page + 1} de ${totalPages}</span>
                    <button id="nextBtn" ${state.page >= totalPages - 1 ? 'disabled' : ''}>Siguiente ‚Üí</button>
                </div>
            `;
        }
        
        // ==========================================
        // EVENTOS
        // ==========================================
        function attachConfigEvents() {
            const form = document.getElementById('configForm');
            if (form) {
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    state.email = document.getElementById('emailInput').value;
                    state.token = document.getElementById('tokenInput').value;
                    safeStorage('set', 'jira_email', state.email);
                    safeStorage('set', 'jira_token', state.token);
                    fetchIssues();
                });
            }
        }
        
        function attachMainEvents() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    state.selectedProject = btn.dataset.project;
                    state.page = 0;
                    fetchIssues();
                });
            });
            
            const resetBtn = document.getElementById('resetBtn');
            if (resetBtn) {
                resetBtn.addEventListener('click', () => {
                    safeStorage('remove', 'jira_email');
                    safeStorage('remove', 'jira_token');
                    state.email = null;
                    state.token = null;
                    state.issues = [];
                    state.error = null;
                    render();
                });
            }
            
            const prevBtn = document.getElementById('prevBtn');
            if (prevBtn) {
                prevBtn.addEventListener('click', () => {
                    if (state.page > 0) { state.page--; fetchIssues(); }
                });
            }
            
            const nextBtn = document.getElementById('nextBtn');
            if (nextBtn) {
                nextBtn.addEventListener('click', () => {
                    state.page++;
                    fetchIssues();
                });
            }
        }
        
        // ==========================================
        // INICIALIZACI√ìN
        // ==========================================
        state.email = safeStorage('get', 'jira_email');
        state.token = safeStorage('get', 'jira_token');
        render();
        
        if (state.email && state.token) {
            fetchIssues();
        }
    </script>
</body>
</html>
